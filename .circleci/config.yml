version: 2

defaults: &defaults
  docker:
      - image: circleci/python:3.7.2
  working_directory: ~/project

prepare_env: &prepare_env
    run:
      name: Create venv
      command: |
        python3 -m venv venv
        source venv/bin/activate
        pip install --upgrade pip

fetch_data: &fetch_data
      run: 
        name: Create venvSet script permission and fetch data
        command: |
          source venv/bin/activate
          chmod +x ./scripts/fetch_kaggle_dataset.sh
          ./scripts/fetch_kaggle_dataset.sh

jobs:
  section_10_deploy_to_heroku:
	    <<: *defaults
	    steps:
	      - checkout
	      - run:
	          name: Deploy to Heroku
	          command: |
	            git push https://heroku:$HEROKU_API_KEY@git.heroku.com/$HEROKU_APP_NAME.git master
	


workflows:
  version: 2
  build-test-and-deploy:
    jobs:
     - section_10_deploy_to_heroku
